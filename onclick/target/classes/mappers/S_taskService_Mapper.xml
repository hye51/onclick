<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.onclick.app.persistence.S_taskService_Mapper">

<insert id="s_taskFileInsert" parameterType="HashMap">
	<selectKey resultType="Integer" keyProperty="fidx" order="AFTER">
		SELECT fidx_seq.CURRVAL FROM DUAL
	</selectKey>
INSERT INTO onclick_file (FIDX,FSAVEDNAME,FORIGINNAME,FTYPE,FROUTE)
VALUES (fidx_seq.nextval,#{savedName},#{originName},#{originalFileExtension},#{route})
</insert>

<update id="s_taskUpdate" parameterType="HashMap">
UPDATE onclick_stutask 
SET TSUBYN='Y', TSUBJECT=#{tsubject}, TDATE=sysdate, TCONTENTS=#{tcontents}, FIDX=#{fidx}
WHERE tidx=#{tidx}
</update>

<select id="s_taskSelectOne" parameterType="Integer" resultType="std">
SELECT *
FROM onclick_stutask
WHERE tdelyn = 'N'
AND tidx=#{tidx}
</select>

<select id="s_taskCheck" parameterType="Integer" resultType="std">
SELECT a.*, b.tuname, b.tustart, b.tufin
FROM onclick_stutask a
JOIN onclick_taskupload b
ON a.tuidx =b.tuidx
WHERE b.tudelyn = 'N'
AND a.sidx=#{0}
AND a.tuidx=#{1}
</select>

<update id="s_taskModify" parameterType="HashMap">
UPDATE onclick_stutask
SET TSUBJECT=#{tsubject}, TDATE=sysdate, TCONTENTS=#{tcontents}
WHERE tidx=#{tidx}
</update>

<update id="s_taskFileModify" parameterType="HashMap">
UPDATE onclick_stutask
SET TSUBJECT=#{tsubject}, TDATE=sysdate, TCONTENTS=#{tcontents}, FIDX=#{fidx}
WHERE tidx=#{tidx}
</update>

<select id="s_taskTidx" parameterType="Integer" resultType="Integer">
SELECT tidx
FROM onclick_stutask
WHERE tdelyn='N'
AND sidx=#{0}
AND tuidx=#{1}
</select>

<select id="stuTask" parameterType="Integer" resultType="std">
SELECT a.*, b.tuname, b.tustart, b.tufin
FROM onclick_stutask a
JOIN onclick_taskupload b
ON a.tuidx = b.tuidx
WHERE b.tudelyn='N'
AND a.sidx=#{sidx}
ORDER BY b.tudate DESC
</select>

<update id="s_taskDelete" parameterType="Integer">
UPDATE onclick_stutask
SET tdelyn='Y', tsubyn='N', tsubject='', tdate='', tcontents=''
WHERE tidx=#{tidx}
</update>

<update id="stuExFileDelete" parameterType="Integer">
UPDATE onclick_stutask
SET FIDX=null
WHERE tidx=#{tidx}
</update>

</mapper> 